<% tab "cart" %>

<script>
  var min = 1

  $(function() {
    $('.qtyplus').click(function(e) {
      var max = event.target.parentNode.parentNode.id;
      alert(max)
      var currentVal = parseInt($("#number").val());
      if (currentVal < max) {
        $("#number").val(currentVal + 1);
      } else {
        $("#number").val(max);
      }
    });
  
    $(".qtyminus").click(function(e) {
      var max = event.target.parentNode.parentNode.id;
      var currentVal = parseInt($("#number").val());
      if (currentVal > min) {
        $("#number").val(currentVal - 1);
      } else {
        $("#number").val(min);
      }
    });

    $( "#number" ).blur(function(e){
      var max = event.target.parentNode.parentNode.id;
      var currentVal = parseInt($("#number").val());
      if (currentVal < min || isNaN(currentVal)) {
        $("#number").val(min);
      } else if(currentVal > max) {
        $("#number").val(max);
      }
    });

  });
</script>

<div class="bg-box">
  <div class="only-mobile cart-banner">
    <span style="color: #ffffff;">購物車</span>
  </div>

  <div class="mobile-none" style="">
    <%= image_tag "step-1.png", style: "width: 90%; margin-left: 5%; margin-bottom: 15px"%>
  </div>
  
  <% if @items.empty? %>

    <div style="height: 280px; display: flex; align-items: center; justify-content: center;">
      <%= image_tag "cart-null.png", style: "height: 40%;"%>
    </div>

    <div style="text-align: center; margin-top: -10%; margin-bottom: 40px;">
      <span>您的購物車沒有商品</span><br>
      <%= link_to root_path do %>
        <button class="member-btn" style="background-color: #59544f; margin: 20px 0px; width: 120px;">去購物</button>
      <% end %>
    </div>

  <% else %>
    <% total = 0 %>
    <% @items.each do |item| %>
      <div style="margin: 10px 30px; border: 0.1px solid; border-color: #c1c0bc; line-height: 18px; height: 122px;">

        <%= link_to remove_from_cart_product_path(item.product), method: :post, remote: true do %>
          <button style="margin: 10px 10px;" type="button" class="close" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        <% end %>

        <%= image_tag item.product.item.main_image, width: "80px", style: "margin: 8px 15px;" %>

        <div style="margin-left: 110px; margin-top: -110px; margin-bottom: -80px;">
          <div>
              <%= item.product.item.name %><br><br>

              <div style="margin-top: 6px; margin-bottom: 6px">
                尺寸&nbsp;&nbsp;<%= item.product.size %>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;顏色&nbsp;
                <div class="colorbox" style="position: relative; top: -16px; left: 108px; background-color: #<%= item.product.color %>;"></div>
              </div>

              單價&nbsp;&nbsp;$<%= item.product.item.price %>
          </div>

          <div id=<%= item.product.stock %> >

            <%= link_to adjust_item_product_path(item.product, type: "substract"), method: :post, remote: true do %>
              <input type='button' value='-' style="font-size:15px; color: #848378;" id='minus' class='qtyminus'/>
            <% end %>

            <input type='text' value=<%= item.quantity %> style='color:#59544f;' id='number' class='qty' />

            <%= link_to  adjust_item_product_path(item.product, type: "add"), method: :post, remote: true  do %>
              <input type='button' value='+' style="color: #848378;" id='plus' class='qtyplus'/>
            <% end %>

          </div>
          
          <div style="margin-top: -75px; margin-left: 300px">
            <p>$&nbsp;<%= item.product.item.price * item.quantity %></p>
          </div>

        </div>

      </div>
      <% total = total + item.product.item.price * item.quantity %>
    <% end %>
    
    <div class="clearfix" style="margin-top: 20px">
      <div style="position: absolute; margin-top: 5px; left: 47%;">

        <span>共&nbsp;<%= @items.pluck(:quantity).inject(:+) %>&nbsp;件商品</span> &nbsp;&nbsp;&nbsp;&nbsp;
        <span>商品金額&nbsp;&nbsp;&nbsp;&nbsp;$ <%= total %></span>  

      </div>
    </div>
  
    <div style="margin-top: 60px;">

      <%= link_to root_path do %>
        <button class="cart-button" style="">←&nbsp;繼續購物</button>
      <% end %>

      <%= link_to order_detail_cart_path do %>
        <button class="cart-button" style="margin-left: 280px; background-color: #9b3af6; color: #ffffff">結帳</button>
      <% end %>

    </div>

  <% end %>
</div>
  